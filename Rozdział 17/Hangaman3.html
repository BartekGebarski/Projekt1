<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Hangman3!</title>
</head>

<body>
    <canvas id="canvas" width="200" height="200"></canvas>
    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        var drawHead = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(20, 20);
            ctx.lineTo(40, 20);
            ctx.lineTo(40, 40);
            ctx.lineTo(20, 40);
            ctx.lineTo(20, 20);
            ctx.stroke();
        };

        var drawBody = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(30, 40);
            ctx.lineTo(30, 80);
            ctx.stroke();
        };

        var drawLeftArm = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(30, 50);
            ctx.lineTo(50, 40);
            ctx.stroke();
        };

        var drawRightArm = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(30, 50);
            ctx.lineTo(10, 40);
            ctx.stroke();
        };

        var drawLeftLeg = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(30, 80);
            ctx.lineTo(50, 90);
            ctx.stroke();
        };

        var drawRightLeg = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(30, 80);
            ctx.lineTo(10, 90);
            ctx.stroke();
        };

        var drawRope = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(30, 20);
            ctx.lineTo(30, 10);
            ctx.stroke();
        };

        var drawRod = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(30, 10);
            ctx.lineTo(70, 10);
            ctx.stroke();
        };

        var drawStick = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(70, 10);
            ctx.lineTo(70, 110);
            ctx.stroke();
        };

        var drawBase = function () {
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(10, 110);
            ctx.lineTo(130, 110);
            ctx.stroke();
        };

        var words = ['javascript', 'monkey', 'amazing', 'pancake', 'tractor', 'blablabla'];
        var pickWord = function () {
            return words[Math.floor(Math.random() * words.length)];
        };
        var setupAnswerArray = function (word) {
            var answerArray = [];
            for (var i = 0; i < word.length; i++) {
                answerArray[i] = '_';
            }
            return answerArray;
        }
        var word = pickWord();
        var answerArray = setupAnswerArray(word);
        var remainingLetters = word.length;
        var wrongGuess = 0;
        var MAX_GUESSES = 10;

        var showPlayerProgress = function () {
            alert(answerArray.join(' '));
        }
        var getGuess = function () {
            var guessResult = prompt('Guess a letter, or click Cancel to stop playing.');
            return guessResult ? guessResult.toLowerCase() : null;
        }

        var showAnswerAndCongratulatePlayer = function () {
            alert(answerArray.join(' '));
            alert('Good job! The answer is ' + word)
        }
        var drawHangman = function() {
            var functions = [
              drawHead,
              drawBody,
              drawLeftArm,
              drawRightArm,
              drawLeftLeg,
              drawRightLeg,
              drawRope,
              drawRod,
              drawStick,
              drawBase,
            ]

            if (functions[wrongGuess - 1]) {
              (functions[wrongGuess - 1])();
            }
        }


        var getLetterAppearence = function (guess) {
          var letterAppearence = 0;

          for (var j = 0; j < word.length; j++) {
            if (word[j] === guess) {
              answerArray[j] = guess;
              letterAppearence++;
            }
          }

          return letterAppearence;
        }

        var startGameIteration = function() {
          showPlayerProgress(answerArray);

          var guess = getGuess();

          if (guess === null) return;

          if (guess.length !== 1) {
            alert('Please enter a single letter.');
            return startGameIteration();
          }

          if (answerArray.indexOf(guess) !== -1) {
            alert('You already guessed this letter!');
            return startGameIteration();
          }

          var letterAppearence = getLetterAppearence(guess)
          remainingLetters = remainingLetters - letterAppearence;

          if (remainingLetters === 0) {
            showAnswerAndCongratulatePlayer();
            return;
          }

          if (letterAppearence === 0) {
            wrongGuess++
            drawHangman();

            if (wrongGuess >= MAX_GUESSES) {
              alert('You lost!');
              return;
            } else {
              setTimeout(startGameIteration, 100);
            }
          } else {
            startGameIteration();
          }
        }

      startGameIteration();

    </script>
</body>

</html>